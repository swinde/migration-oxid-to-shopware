<?xml version="1.0" encoding="UTF-8" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services
                               https://symfony.com/schema/dic/services/services-1.0.xsd">
    <!-- ========================================================= -->
    <!-- === Default-Werte fÃ¼r Plugin-Konfiguration ============== -->
    <!-- ========================================================= -->
    <parameters>
        <parameter key="migration_oxid_to_shopware.config.apiUrl">https://test-sw6.ddev.site</parameter>
        <parameter key="migration_oxid_to_shopware.config.accessKeyId">SWIAEGTKNELRCMNWEHJXAUNJBG</parameter>
        <parameter key="migration_oxid_to_shopware.config.accessKeySecret">Y3BqS1dUVEJmRDNxRG9XaVJUYmJpQ3Y2cXZkc3piaFVSQ0w4MFI</parameter>

        <parameter key="migration_oxid_to_shopware.config.oxidHost">db</parameter>
        <parameter key="migration_oxid_to_shopware.config.oxidPort">3306</parameter>
        <parameter key="migration_oxid_to_shopware.config.oxidDatabase">neue_db</parameter>
        <parameter key="migration_oxid_to_shopware.config.oxidUser">db</parameter>
        <parameter key="migration_oxid_to_shopware.config.oxidPassword">db</parameter>
        <parameter key="migration_oxid_to_shopware.config.oxidImageBasePath">https://www.seifenstueck.de/out/pictures/master/</parameter>

        <parameter key="migration_oxid_to_shopware.config.salesChannelId">0199E6C14E3A737E825CF8871F33B9CC</parameter>
    </parameters>

    <services>

        <!-- ========================================================= -->
        <!-- === Logger ============================================== -->
        <!-- ========================================================= -->
        <!-- Logger-Aliase: sowohl Interface als auch "monolog.logger" zeigen auf den Standard-Logger -->
        <service id="Psr\Log\LoggerInterface" alias="logger" />
        <!--<service id="monolog.logger" alias="logger" />-->

        <!-- ========================================================= -->
        <!-- === OXID Connector ====================================== -->
        <!-- ========================================================= -->
        <service id="MigrationSwinde\MigrationOxidToShopware\Connectors\OxidConnector">
            <argument type="service" id="logger"/>

            <!-- Wir erstellen PDO in der Factory -->
            <factory service="MigrationSwinde\MigrationOxidToShopware\Factory\PdoFactory" method="createOxidPdo"/>

            <argument type="service" id="logger"/>
        </service>

        <!-- ========================================================= -->
        <!-- === Shopware Connector ================================== -->
        <!-- ========================================================= -->
        <service id="MigrationSwinde\MigrationOxidToShopware\Connectors\ShopwareConnector">
            <argument>%migration_oxid_to_shopware.config.apiUrl%</argument>
            <argument>%migration_oxid_to_shopware.config.accessKeyId%</argument>
            <argument>%migration_oxid_to_shopware.config.accessKeySecret%</argument>
            <argument>%migration_oxid_to_shopware.config.oxidImageBasePath%</argument>
            <argument>%migration_oxid_to_shopware.config.salesChannelId%</argument>
            <argument type="service" id="logger"/>
        </service>

        <!-- ========================================================= -->
        <!-- === Category Migrator =================================== -->
        <!-- ========================================================= -->
        <service id="MigrationSwinde\MigrationOxidToShopware\Migration\CategoryMigrator">
            <argument type="service" id="MigrationSwinde\MigrationOxidToShopware\Connectors\OxidConnector"/>
            <argument type="service" id="MigrationSwinde\MigrationOxidToShopware\Connectors\ShopwareConnector"/>
            <argument type="service" id="logger"/>
        </service>

        <!-- PDO Factory -->
        <service id="MigrationSwinde\MigrationOxidToShopware\Factory\PdoFactory">
            <argument type="service" id="logger"/>
        </service>

        <!-- PDO aus Factory (Oxid-Datenbank) -->
        <service id="oxid_pdo" class="PDO">
            <factory service="MigrationSwinde\MigrationOxidToShopware\Factory\PdoFactory" method="createOxidPdo"/>
            <argument>%migration_oxid_to_shopware.config.oxidHost%</argument>
            <argument>%migration_oxid_to_shopware.config.oxidPort%</argument>
            <argument>%migration_oxid_to_shopware.config.oxidDatabase%</argument>
            <argument>%migration_oxid_to_shopware.config.oxidUser%</argument>
            <argument>%migration_oxid_to_shopware.config.oxidPassword%</argument>
        </service>

        <!-- OxidConnector -->
        <service id="MigrationSwinde\MigrationOxidToShopware\Connectors\OxidConnector">
            <argument type="service" id="oxid_pdo"/>
            <argument type="service" id="logger"/>
        </service>

        <service id="MigrationSwinde\MigrationOxidToShopware\Command\MigrateCategoriesCommand">
            <argument type="service" id="MigrationSwinde\MigrationOxidToShopware\Migration\CategoryMigrator"/>
            <tag name="console.command" />
        </service>


    </services>
</container>
